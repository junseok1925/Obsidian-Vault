
# 기본 시스템 소개
### web GIS
- java : JDK 1.8.101 이상
- PostgreSQL 10.6, PostGIS 2.5.0 이상
- Apache Tomcat 9 이상
- Chrome 최신버전 (너무 오래된 구버전 x ) - 영상 재생 안될 시 chrome 업데이트 필요
### 영상반출시스템
 - 8 x 2 = 16코어, 램 32, ssd 250, hdd 5tb 이상( 반출 환경에 따라 hdd 용량은 증설 필요)
 - window Server 2016 R2 이상
 
### XEUS-GATE
- 16코어, 램 32GB 이상, hdd 100GB (리눅스는 특히 log가 많이 쌓이면 용량 부족 오류 발생, log 정리 필수),  gpu 엔디비아 계열 H.265 디코딩, 인코딩 세션 무제한 
- window Server 2016 R2 이상, CenterOS 7 이상 , ubuntu 18.04 이상
- 
# tomcat 설치

# 영상반출 오류
1. 영상이 안나와요
   - id,pw 변경 여부확인
   - 망연계 오류 -> 시,군을 봐야함
   - gbn_cd : 관리목적
   - _gib : 지오멕스에서 관리하는 고유번호 - 건들면 안됨
   - 위,경도 위치 작성 실수하지말기
   - 5553 리얼허브, 레오파드
   - 뷰릭스, 리얼허브, 레오파드, 영상반출 엔진
   - 게이트가 영상을 가져오는 것은 브릿지만 연결되면 된다
   - 광역 DB를 바라본다 따라서 DB 세팅을 외부 광역DB를 바라보게 해야한다.
   - was서버에서 gate 서버가 오류가 나면 watch dog에서 was서버를 재실행한다

## Aparche Tomcat 구조
1. logs 파일이 제일 중요함
   문제 발생 시 /log/xeus-.log 파일 압축 후 전송
2. db에 데이터가 없으면 리스트에 아예 카메라 목록이 안 뜸
3. 점검페이지 설정 config 파일 위치에서 페스워드 변경가능
4. 영상 동시전송 수를 설정
   gate.server.poolsize=100으로 설정 -> 계속 켜놓는 경우가 많음, 성능이 좋으면 더 늘려두되나 100으로 설정하는게 적당함

Postgresql 9~10 버전만 써야함 9.2는 한 번 문의해야함 (DB 뻣음)
pool 만큼 생성하기 땜에 해당 범위내 쓰는지 안쓰는지 확인 필요, 하지만 단독으로 쓰긴함

기초 엔지니어 지식이 있으면 개발에 좋은 영향을 줌. 유리해짐. 근데 전문성은 조금 떨어짐

## 장애대응
1. 주요 장애 사례
	1. 영상 백업 중에 발생
	   - VMS와의 접속이 끊어져 발생, 일시적인 네트워크 장애, 저장영상이 없는경우, VMS 내 오류로 인한 백업 실패, GIS 상 CCTV 목록이 VMS 목록과 동기화되지않을 때
	2. 서비스 재실행
	   - Crms이름이 포함된 모든 서비스를 재실행하기
	3. 로그 상에 파일 못 찾는다 -> 중복파일생성으로 뒤에 (1)이 붙어서
	4. 백업실패 -> 백업 프로세스 서비스의 로드를 확인 
	5. 쿼리를 입력해서 db 수정해야할 수 도 있음 쿼리문 전달 예정
	6. DB 작업 전에 백업은 필수임
	7. 결국 재시작하는게 좋음, 백업 프로세스 재 시작, 작업스캐줄러 등록 확인 후 조치
	8. TVIUS WAS 로그 레벨 확인 (DEBUG 레벨인 경우 ERORR 레벨로 변경)
	9. 하드디스크 증설, 추가x -> D드라이브 용량을 늘려야 함
	10. 수정된 날짜 30일 이상인 경우의 파일만 삭제 함
	11. 영상이 늦게 다운로드 되는 경우가 있음
	    - 외산의 경우가 그런 경우가 많음
	    - sdk에서 변환하는 시간이 오래 걸리니까 vms 업체에 문의를 해야 한다.
	12. 영상자동 삭제는 100일이 지나면 삭제되니까 무족건 사전에 말해야함
	13. TVIUS 재상오류 
	    - "정책 값이 잘못 되었습니다" -> 서버의 시간이 더 빨랐을 경우 서버내 시간 동기화가 필요
	14. 뷰릭스 장애 
	    - 명칭에 특수문자가 포함된 cctv
	    - 1.7 버전으로 업데이트 해주세요
	    - licence problem : redis 재실행
	15. 통합 플랫폼 지도 표출 오류 : 망 연계 장비 및 서버 방화벽 설정 확인( 주로 외부 웹 지도, 다음맵 같은 지도를 쓰기 때문에), 프록시 서비스(apache tomcat) 재 시작, gis and web gis 재시작 -> 아예 지도가 없어지면 라이센스 재발급 필요, 맥주소로 라이센스 발급 필요
	16. Out of Memory -> 톰캣/bin/서비스명.exe 관리자 권한 실행 후 JAVA 탭으로 이동 Maximum memory pool 수정
	17. VMS 계정은 무족건 관리자 권한을 주라고 해야 함
	18. bin 경로에 서비스 exe 파일이 있음
	19. xeus-gate는 jdk 1.8 아니면 오류가 남
