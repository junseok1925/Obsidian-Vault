### 구성

![[Pasted image 20251016171026.png]]


![[Pasted image 20251016171002.png]]

---

### main.dart

```dart
import 'package:flutter/material.dart';
import 'package:flutter_movie_reservation_app/seat_bottom.dart';
import 'package:flutter_movie_reservation_app/seat_select_box.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(home: SeatPage());
  }
}

class SeatPage extends StatefulWidget {
  @override
  State<SeatPage> createState() => _SeatPageState();
}

class _SeatPageState extends State<SeatPage> {
  int? selectedRow;
  int? selectedCol;

  void onSelected(int row, int col) {
    // 좌석 선택 함수
    setState(() {
      selectedRow = row;
      selectedCol = col;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('좌석')),
      backgroundColor: Colors.grey[200],
      body: Column(
        children: [
          SeatSelectBox(selectedRow, selectedCol, onSelected),
          SeatBottom(selectedRow, selectedCol),
        ],
      ),
    );
  }
}

```

- 선택된 좌석에 따라 동적으로 작동하기 때문에 `StatefulWidget` 상속 사용
- 선택한 좌석의 번호를 받아 매개변수로 사용하기 위해 `selectedRow`, `selectedCol` 선언
- `onSelected()`함수로 선택 받은 row와 col 값을 `selectedRow`, `selectedCol`으로 `setState()` 함

---

### seat_select_box.dart

```dart
import 'package:flutter/material.dart';

class SeatSelectBox extends StatelessWidget {
  SeatSelectBox(this.selectedRow, this.selectedCol, this.onSelected);

  int? selectedRow;
  int? selectedCol;
  void Function(int row, int col) onSelected;

  @override
  @override
  Widget build(BuildContext context) {
    return Expanded(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Text(
            'Screen',
            style: TextStyle(fontSize: 25, fontWeight: FontWeight.bold),
          ),
          SizedBox(height: 20),
          seatRow(1),
          SizedBox(height: 10),
          seatRow(2),
          SizedBox(height: 10),
          seatRow(3),
          SizedBox(height: 10),
          seatRow(4),
          SizedBox(height: 10),
          seatRow(5),
          SizedBox(height: 10),
          Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              label('빈좌석', Colors.grey),
              SizedBox(width: 10),
              label('예약완료', Colors.amber),
            ],
          ),
        ],
      ),
    );
  }

// 하단 선택 된 좌석과 예약하기 버튼 구역
  Row label(String text, Color color) {
    return Row(
      children: [
        Text(text),
        SizedBox(width: 5),
        Container(
          width: 20,
          height: 20,
          decoration: BoxDecoration(
            color: color,
            borderRadius: BorderRadius.circular(5),
          ),
        ),
      ],
    );
  }

// 좌석 한줄
  Widget seatRow(int rowNum) {
    return Padding(
      padding: EdgeInsets.symmetric(horizontal: 20),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Expanded(
            child: Center(
              child: Text(
                '$rowNum',
                style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
              ),
            ),
          ),
          seat(rowNum, 1),
          seat(rowNum, 2),
          seat(rowNum, 3),
          seat(rowNum, 4),
          seat(rowNum, 5),
          seat(rowNum, 6),
          seat(rowNum, 7),
          seat(rowNum, 8),
          seat(rowNum, 9),
          seat(rowNum, 10),
        ],
      ),
    );
  }

// 좌석 하나
  Widget seat(int rowNum, int colNum) {
    return Expanded(
      child: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 3),
        child: GestureDetector(
          //좌석 선택 시 반응 추가
          onTap: () {
            onSelected(rowNum, colNum);
          },
          child: AspectRatio(
            aspectRatio: 1,
            child: Container(
              width: 30,
              height: 30,
              decoration: BoxDecoration(
                // 선택한 죄석과 rowNum이 같으면 amber, 아니면 grey (선택한 좌석 컬러 amber주기)
                color: rowNum == selectedRow && colNum == selectedCol
                    ? Colors.amber
                    : Colors.grey,
                borderRadius: BorderRadius.circular(7),
              ),
            ),
          ),
        ),
      ),
    );
  }
}

```

- 코드 반복 방지와 가독성을 위해 `seat`, `seatRow`를 `Extract Method`하여 따로 관리
- `main.dart`에서 매개변수로 받은 `selectedRow`,`selectedCol` (좌석 번호)를 통해 선택된 좌석에 대한 함수 실행

---
### seat_bottom.dart
```dart
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

class SeatBottom extends StatelessWidget {
  SeatBottom(this.selectedRow, this.selectedCol);
  int? selectedRow;
  int? selectedCol;

  @override
  Widget build(BuildContext context) {
    return Container(
      height: 200,
      width: double
          .infinity, // container의 크기는 자식요소의 크기에 맞게 설정되므로 width를 가능한 최대 넓이로 설정
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
      ),
      child: Column(
        children: [
          SizedBox(height: 20),
          Text(
            selectedRow == null && selectedCol == null
                ? '선택된 좌석 없음 '
                : '선택 좌석: $selectedRow - $selectedCol번',
            style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
          ),
          SizedBox(height: 20),
          SizedBox(
            width: 200,
            height: 50,
            child: ElevatedButton(
              onPressed: () {
                //버튼 클릭 시 실행 될 함수 - 예매 확인 alert 창
                showCupertinoDialog(
                  context: context,
                  builder: (context) {
                    return CupertinoAlertDialog(
                      title: Text('예약확인'),
                      content: Text(
                        '$selectedRow - $selectedCol번 좌석 예매하시겠습니까?',
                      ),
                      actions: [
                        CupertinoDialogAction(
                          isDefaultAction: true, //기본 버튼 스타일 적용 (굵은 텍스트)
                          // 취소버튼 클릭 시
                          onPressed: () {
                            Navigator.of(context).pop(); //뒤로가기
                          },
                          child: Text('취소'),
                        ),
                        CupertinoDialogAction(
                          isDestructiveAction: true, // 주의/삭제/확정 성격의 버튼 (빨간색)
                          // 확인버튼 클릭 시
                          onPressed: () {},
                          child: Text('확인'),
                        ),
                      ],
                    );
                  },
                );
              },
              style: ElevatedButton.styleFrom(backgroundColor: Colors.orange),
              child: Text('예약하기'),
            ),
          ),
        ],
      ),
    );
  }
}

```

- `main.dart`에서 매개변수로 받은 `selectedRow`,`selectedCol` (좌석 번호)를 통해 선택된 좌석에 대한 함수 실행
- `showCupertinoDialog` : ios 스타일의 Alert 팝업 창 생성

### 추가 구현

```dart
CupertinoDialogAction(
	isDestructiveAction: true, // 주의/삭제/확정 성격의 버튼 (빨간색)
	// 확인버튼 클릭 시
	onPressed: () {
		Navigator.of(context).pop(); // 팝업 닫기
	// 팝업 Alert창 띄우기
		showCupertinoDialog(
			context: context,
            builder: (context) {
			// 1초 후 닫기
				Future.delayed(Duration(seconds: 1), () {
					Navigator.of(context).pop(); // 팝업 닫기
                });
            // 띄울 Alert 창 설정
                return CupertinoAlertDialog(
	                title: Text(
                            '예매되었습니다.',
                    style: TextStyle(
                    fontSize: 15,
                    fontWeight: FontWeight.bold,
	                    ),
                    ),
                );
            },
        );
    },
    child: Text('확인'),
),
```
- 확인 클릭시 `CupertinoAlertDialog`  “예매되었습니다. “팝업 창을 띄운 후 1초 후에 닫기
![[Pasted image 20251016235340.png]]