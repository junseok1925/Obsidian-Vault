
### Firebase

Google에서 제공하는 모바일 및 웹 어플리케이션 개발 플랫폼

서비스를 직접 구축하지 않아도 로그인, 데이터 저장, 알림 등을 손쉽게 구현할 수 있는 클라우드 백엔드 서비스

### Firestore

Firebase에서 제공하는 클라우드 기반 NoSQL 데이터베이스
앱에서 생성되는 데이터를 실시간으로 저장하고 동기화


---
#### Firebase 설치

1. `curl -sL https://firebase.tools | bash`  : 설치 스크립트 (터미널)
2. `firebase` : 설치 확인
3. `firebase lgoin` : 구글 아이디로 로그인
#### Firestore 설치
1. `dart pub global activate flutterfire_cli` : 설치 스크립트(터미널)
2. 해당 스크립트 입력시 나온 코드 복사`export PATH="$PATH":"$HOME/.pub-cache/bin"`
3. `nano ~/.zshrc` 로 환경변수 수정
4. 복사한 코드 `export PATH="$PATH":"$HOME/.pub-cache/bin"` 붙여넣고 ctrl + x , Y, enter 로 입력한 환경변수 저장
5. 터미널 종료 후 다시 열어 `flutterfire` 입력 시 `FlutterAppRequiredException: .... 어쩌구` 라는 메시지가 나오면 정상
---

#### Firebase 프로젝트 만들기

1. firebase 홈페이지에 가서 콘솔 -> 프로젝트 생성
2. 내 프로젝트 파일 vsCode로 실행 후 해당 터미널에서 `flutterfire configure` 실행
3. 내 프로젝트 선택 후 엔터
4. android, ios 만 선택 후 엔터

### Firebase에 저장된 데이터 가져오기 (Read)

```dart
// 데이터 Firestore에서 가져오는 함수
  // READ
  void loadTodos() async {
    // 켜기 - 폴더 열기 - 전체 선택해서 실행
    //firestore 인스턴스 가져오기- 컬렉션 참조 만들기 - 데이터 가져오기

    // firestore 인스턴스 가져오기
    final firestore = FirebaseFirestore.instance;
    // "todos"라는 이름의 컬렉션 참조 가져오기
    final colRef = firestore.collection("todos");
    // 해당 컬렉션에 있는 모든 문서 가져오기 (비동기, await 필요)
    // 내림차순서대로 가져오기
    final query = colRef.orderBy('createdAt', descending: true);
    final querySnapsot = await query.get();

    // 가져온 결과에서 문서들만 리스트로 추출
    final documents = querySnapsot.docs;

    List<Todo> newTodoList = [];

    // 가져온 문서 리스트를 반복문으로 todoList 리스트 변수에 넣기
    for (var i = 0; i < documents.length; i++) {
      final data = documents[i];
      print(data.data());
      final map = data.data();
      // firebase 데이터베이스에서 가져온 데이터를 todoList로 가져와야함
      Todo newTodo = Todo(title: map['title'], isDone: map['isDone']);
      newTodoList.add(newTodo); // db에서 가져온 데이터를 todoList에 넣기
      todoList = newTodoList;
      // 상태 갱신 -> 화면 다시 그리기
      setState(() {});
    }
  }

```


![[Pasted image 20250921195645.png]]


- `loadTodo()` 함수로 firestore 인스턴스를 가져온 후 순서대로 컬랙션 -> 문서 ->문서 리스트로 추출 작업
- 반복문의로 추출된 문서 리스트 `documents`를 `todoList` 리스트 변수에 할당
- `setState(() {});` 로 데이터를 가져올 때마다 화면 갱신

 _`final querySnapsot = await colRef.get();` 비동기로 가져오는 이유_

- `final firestore = FirebaseFirestore.instance;`  
    → Firestore 인스턴스를 가져옴 (**앱에 이미 초기화된 객체라 즉시 가능**)
    
- `final colRef = firestore.collection("todos");`  
    → "todos" 컬렉션을 **참조**하는 객체를 생성 (**서버 요청 없음, 즉시 가능**)
    
- `final querySnapshot = await colRef.get();`  
    → 실제 Firestore 서버에 네트워크 요청을 보내서 "todos" 컬렉션 안의 문서를 가져옴  
    → 데이터 양/네트워크 상태에 따라 지연 발생 가능 → **비동기(Future)로 처리 필요**

<aside> ✅
	UI 멈춤 (프레임 드랍) 없이 앱이 매끄럽게 동작하기 위해 데이터를 가져오는 부분은 비동기로 처리하는게 좋음 
</aside>


----

### Firebase에 데이터 저장하기 (Create)

todo 앱 내에서 사용자가 입력한 "할 일 텍스트"를 Firestore에 저장한다.

```dart

  void onCreate() async {
    // firetore에 입력된 todo create
    // 1. firestore 인스턴스 가져오기 - 2. 컬렉션 참조 만들기 - 3.문서 참조 만들기(id 새로만들기) -> 4.저장

    // 1.
    final firestore = FirebaseFirestore.instance;
    // 2.
    final colRef = firestore.collection("todos");
    // 3.
    final docRef = colRef.doc(); //.doc() : 비워두면 자동으로 유니크한 id로 문서 생성
    Map<String, dynamic> map = {
      'title': controller.text,
      'isDone': false,
      'createdAt': DateTime.now().toIso8601String(),
    };
    await docRef.set(map);
    loadTodos();
    setState(() {
      controller.clear(); //textField 입력창 클리어
    });
  }

```

1. Read와 동일하게 firestore 인스턴스를 가져와 컬랙션 참조 만들기 후 문서 참조 만든다.
2. title 과 isDone을 가져오고, `DateTime.now().toIso8601String()`으로 생성된 시간을 가져와 문서 저장
3. 동일하게 앱 성능을 위해 비동기로 처리
4. `loadTodos();` read 함수와 `setState();` 함수를 실행하여 적은 todo리스트를 추가할 때 마다 실시간으로 업데이트
----

### Firebase에 데이터 삭제하기 (Delete)

todo.dart
```dart
class Todo {
	String id;
	String title;
	bool isDone;
	Todo({required this.id, required this.title, required this.isDone});
}
```

- firebase에서 삭제할 문서데이터를 특정하기 위해 `id` 값 추가

```dart
if (result) {
  // 삭제버튼을 누른다면
  // todoeList 리스트 안에 있는 index 요소 삭제
  print('$index번쪠 todoList요소 삭제함');
  // firestore에서 해당 id 문서를 삭제
  // 1. firestore 인스턴스 가져오기 - 2. 컬렉션 참조 만들기 - 3.삭제할 id를 가진 문서 참조  -> 4.삭제
  final firestore = FirebaseFirestore.instance; // 1.
  final colRef = firestore.collection("todos"); // 2.
  final docRef = colRef.doc(todo.id); // 3.
  await docRef.delete(); // 4.
  loadTodos(); //loadTodos() 함수 안에 이미 setStat()를 실행하므로 setState()생략
}
```

- `final docRef = colRef.doc(todo.id); // 3.` : todo.id 를 가져와 특정한 id를 가진 문서 삭제