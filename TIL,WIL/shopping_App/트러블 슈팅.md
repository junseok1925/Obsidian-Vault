```dart

            onTap: () {
              if (alreadyCart) {
                cartModel.removeItemCart(name);
                showCupertinoDialog(
                  context: context,
                  builder: (context) => CupertinoAlertDialog(
                    title: Text("제거 완료"),
                    content: Text("장바구니에서 제거되었습니다."),
                    actions: [
                      CupertinoDialogAction(
                        isDefaultAction: true,
                        onPressed: () => Navigator.of(context).pop(),
                        child: Text("확인"),
                      ),
                    ],
                  ),
                );
              } else {
                print('장바구니에 있는 상품임? : $alreadyCart, false니까 추가 함,');
                cartModel.addItem(name, price, imagePath: imagePath);
                showCupertinoDialog(
                  context: context,
                  builder: (context) => CupertinoAlertDialog(
                    title: Text("추가 완료"),
                    content: Text("장바구니에 추가되었습니다."),
                    actions: [
                      CupertinoDialogAction(
                        isDefaultAction: true,
                        onPressed: () => Navigator.of(context).pop(),
                        child: Text("확인"),
                      ),
                    ],
                  ),
                );
              }
              onCartToggle(); // setState() 콜백 함수 실행
            },
          ),
```

상황
- 장바구니 아이콘을 누르면 추가 완료 Dialog창이 뜨지만 추가는 안됨
- 아이콘 색상 (alreadyCart)는 갱신되어 바뀌지만 계속 추가만 됨 → 이미 추가되어있으면 삭제되어야 함

원인
- `ImageTopIcons` 위젯이 **StatelessWidget**이라 내부 상태(`alreadyCart`)를 직접 바꾸지 못함.  
	즉, 버튼 클릭 후에도 `alreadyCart` 값이 `false`로 유지되어  
	매번 장바구니 추가 로직만 실행됨.

원인 분석
- `ImageTopIcons`은 상태를 자체적으로 관리하지 않음.

- 상위인 `ProductDetailsPage`가 `alreadyCart`를 전달하지만,  
    클릭 시 `setState()`로 다시 빌드가 안 됨.
- 결과적으로 UI와 데이터 상태 불일치(State Desync) 발생.

해결방법
- **콜백 함수(`onCartToggle`) 추가**
	- 하위 위젯에서 버튼 클릭 시 호출 → 상위 위젯(`ProductDetailsPage`)의 상태 변경
```dart
      // bottomSheet 영역
	bottomSheet: ProductBottomSheet(
        onCartToggle: () {
          setState(() { // 상태 변경 -> ProductBottomSheet는 stateless라서 여기서 해야 함
            alreadyCart = !alreadyCart;
          });
        },
    name: name,
    imagePath: imagePath,
    price: price,
    contents: contents,
    alreadyCart: alreadyCart,
      ),
```

- 상위 위젯에서 setState()로 상태 갱신
- 클릭할 때마다 `alreadyCart` 토글
	- UI가 즉시 반영됨


```dart
import 'package:flutter/material.dart';

import 'package:intl/intl.dart';

  

class ProductInfoSection extends StatelessWidget {

final String name;

final int price;

final String contents;

ProductInfoSection({

required this.name,

required this.price,

required this.contents,

});

  

@override

Widget build(BuildContext context) {

final formattedPrice = NumberFormat("#,###").format(price);

  

return Column(

crossAxisAlignment: CrossAxisAlignment.start,

children: [

SizedBox(height: 20),

// 상품명

Padding(

padding: EdgeInsets.symmetric(horizontal: 20),

child: Text(

name, // item에서 이름 사용

style: TextStyle(fontSize: 23, fontWeight: FontWeight.bold),

softWrap: true,

),

),

SizedBox(height: 10),

// 상품 가격

Padding(

padding: EdgeInsets.symmetric(horizontal: 20),

child: Text(

'$formattedPrice원', // intl로 포맷한 item에서 가격 사용

style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),

),

),

SizedBox(height: 20),

// 상품 설명

Padding(

padding: EdgeInsets.symmetric(horizontal: 20),

child: Text(

contents ?? '상품 설명 없음', // item에서 설명 사용

// '상품 설명 없음', // item에서 설명 사용

style: TextStyle(fontSize: 16, color: Colors.grey[700]),

),

),

],

);

}

}
```