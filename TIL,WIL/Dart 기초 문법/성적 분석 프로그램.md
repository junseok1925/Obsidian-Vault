


1. 사용자로부터 입력 받아 학생 점수 확인
   - 학생 점수 데이터는 .csv파일로 저장되어있음 `dart:io` 라이브러리의 File 클래스를  사용해서 읽어오라

2. 조회한 학생의 이름과 점수를 .csv 파일로 저장하라 

3. 사용자가 1 입력 시 가장 높은 점수를 가진 우수생을 출력, 2 입력 시 전체 학생들의 평균점수 출력


#### 1. 점수 확인
```dart
import 'dart:io';

class Student {
  String name;
  int score;

  Student(this.name, this.score);

  void showInfo() {
    print('이름: $name,점수: $score');
  }
}

// csv파일에서 학생 데이터 가져오기
Map<String, int> loadStudentData(String filePath) {
  Map<String, int> studentMap = {};
  try {
    final file = File(filePath);
    final line = file.readAsLinesSync(); // -> csv파일의 각 줄을 리스트로 가져옴

    for (var line in line) {
    
	  final isLineEmpty = line.trim();
      if (isLineEmpty.isEmpty) {
	      continue; // 빈 줄이면 다음 줄로 넘어감
	      }
      final parts = line.split(',');
      if (parts.length != 2) {
        throw FormatException('잘못된 데이터 형식: $line');
      }
      String name = parts[0];
      int score = int.parse(parts[1]);

      studentMap.putIfAbsent(name, () => score);
    }
  } catch (e) {
    print("학생 데이터 가져오기 실패 $e");
    exit(1);
  }

  print('csv파일에서 가져온 학생 점수 데이터 : $studentMap');

  return studentMap;
}

void main() {
  String filePath = 'score.csv';
  Map<String, int> studentData = loadStudentData(filePath);


    print('어떤 학생의 점수를 확인하시겠습니까? (그만하려면 exit or 종료 입력): ');
    String? inputName = stdin.readLineSync();

    if (inputName == null || inputName.isEmpty) continue;
	if(inputName == 'exit' || inputName == '종료') break;

    if (studentData.containsKey(inputName)) {
      print('$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.');
    } else {
      print('$inputName 학생은 없는 학생입니다.');
    
}
```

1. `readAsLinesSync` 메서드 사용으로 해당 .csv 파일의 내용 가져온다.
	-  Lsit 타입으로 가져오게 된다 `line = [ten,100, nine,90, eight,80, seven,70, six,60, five,50, four,40, three,30, two,20, one,10]`
	- 
2. `line` 변수를 반복문을 통해 `,` 기준으로 나눠 `name` 과 `score`를 추출한다.

3. `studentMap.putIfAbsent(name, () => score);` 메서드를 통해 `name`을 key로 `score`를 value로 추가한다.

4. `studentMap`에는 학생들 이름을 Key값으로 Value는 해당 학생의 점수가 들어가게 된다.
	- `studentMap : {ten: 100, nine: 90, eight: 80, seven: 70, six: 60, five: 50, four: 40, three: 30, two: 20, one: 10}`



##### Fix - .csv파일에 빈줄이 있을 경우 예외처리
- .csv 파일을 읽어와 안에 내용을 Map형식으로 출력하려했으나 
```
학생 데이터 가져오기 실패 FormatException: 잘못된 데이터 형식: 
```

-> 다음과 같은 오류가 남.
SV 파일에 빈 줄(또는 공백만 있는 줄)이 있어서 `split(',')` 결과가 `parts.length != 2`가 되어 예외가 던져진 것

```dart
final isLineEmpty = line.trim();
	if (isLineEmpty.isEmpty) {
		continue; // 빈 줄이면 다음 줄로 넘어감
}
```
 csv파일의 각 줄을 리스트로 가져는 for()문 안에 각 줄의 리스트를 값으로 담고 있는 `line.trim()` 메서드로 공백을 모두 삭제한 한 줄의 값을 가져와 `empty` 를 확인하는 로직 추가



---


#### 조회 학생에 대한 파일 생성
```dart
import 'dart:io';

class Student {
  String name;
  int score;

  Student(this.name, this.score);

  void showInfo() {
    print('이름: $name,점수: $score');
  }
}

// csv파일에서 학생 데이터 가져오기
Map<String, int> loadStudentData(String filePath) {
  Map<String, int> studentMap = {};
  try {
    final file = File(filePath);
    final line = file.readAsLinesSync(); // -> csv파일의 각 줄을 리스트로 가져옴
    for (var line in line) {
      final parts = line.split(',');
      if (parts.length != 2) {
        throw FormatException('잘못된 데이터 형식: $line');
      }
      String name = parts[0];
      int score = int.parse(parts[1]);

      //studentMap안에 name이라는 key가 없으면 그 key를 추가하소 score를 value로 넣기
      studentMap.putIfAbsent(name, () => score);
    }
  } catch (e) {
    exit(1);
  }
  return studentMap;
}

void writeFile(String filename, String content) {
  try {
    final file = File(filename);
    file.writeAsStringSync(content);
    print('파일 생성 완료');
  } catch (e) {
    print('파일 생성 실패 $e');
  }
}

void main() {
  String filePath = 'score.csv';
  Map<String, int> studentData = loadStudentData(filePath);

  while (true) {
    print('어떤 학생의 점수를 확인하시겠습니까? (그만하려면 exit or 종료 입력): ');
    String? inputName = stdin.readLineSync();

    if (inputName == null || inputName.isEmpty) continue;
    if (inputName == 'exit' || inputName == '종료') {
      print('종료합니다.');
      break;
    }

    if (studentData.containsKey(inputName)) {
      print('$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.');
      writeFile(
        '$inputName.csv',
        '$inputName 학생의 점수는 ${studentData[inputName]}점입니다.',
      );
    } else {
      print('$inputName 학생은 없는 학생입니다.');
    }
  }
}

```


**writeFile() 메서드 생성**
1. `filename`과 `content` 를 매개변수로 받아 조회한 학생의 이름과 점수로 파일 생성

2. ` studentData.containsKey(inputName)`  : `containsKey()` 메서드로 해당 학생의 이름으로 된 Key 존재 시 조건문에 점수 조회와 동시에 해당 학생의 이름과 점수에 대한 .csv파일 생성

##### Fix - 동기 처리
`file.writeAsStringSync(content);` 메서드로 content를 내용으로 파일 생성
	- `writeAsString` 처음에 해당 메서드를 사용했음. (비동기방식)
	- 파일은 생성되나 내용이 없는 빈 파일로 생성 됨.
	- 아직 파일 쓰기가 완료되지 않은 상태에서 프로그램이 종료되거나 다른 코드가 실행되면 
	- 파일은 생성되지만 내용이 비어있을 수 있음



#### 3-1. 우수생 조회 기능
```dart
import 'dart:io';
import 'dart:math' as math;

class Student {
  String name;
  int score;

  Student(this.name, this.score);

  void showInfo() {
    print('이름: $name,점수: $score');
  }
}

// csv파일에서 학생 데이터 가져오기
Map<String, int> loadStudentData(String filePath) {
  Map<String, int> studentMap = {};
  try {
    final file = File(filePath);
    final line = file.readAsLinesSync(); // -> csv파일의 각 줄을 리스트로 가져옴

    for (var line in line) {
      final isLineEmpty = line.trim();

      if (isLineEmpty.isEmpty) {
        continue; // 빈 줄이면 다음 줄로 넘어감
      }
      final parts = line.split(',');
      if (parts.length != 2) {
        throw FormatException('잘못된 데이터 형식: $line');
      }
      String name = parts[0];
      int score = int.parse(parts[1]);

      studentMap.putIfAbsent(name, () => score);
    }
  } catch (e) {
    print("학생 데이터 가져오기 실패 $e");
    exit(1);
  }

  print('csv파일에서 가져온 학생 점수 데이터 : $studentMap');

  return studentMap;
}

// studnetData를 매개변수로 받는다.
void topStudent(Map<String, int> studentData) {
  if (studentData.isEmpty) {
    print('데이터가 없습니다.');
    return;
  }
  // 두 값을 비교해서 더 큰 값 하나만 반환한다.
  // reduce : 모든 값을 하나씩 순서대로 꺼내서 함수 (a,b)에 넣고 누적해서 하나의 결과를 만든다
  // int topScore = studentData.values.reduce((a, b) => a > b ? a : b);

  //math 라이브러리의 max 함수 사용으로 더 간편하게 가장 큰 값 구하기
  int topScore = studentData.values.reduce(math.max);

  var topStudent = studentData.keys.where(
    (name) => studentData[name] == topScore,
  );

  print('우수생 : $topStudent (점수 : $topScore 점)');
}

void writeFile(String filename, String content) {
  try {
    final file = File(filename);
    file.writeAsStringSync(content);
    print('$filename 파일이 생성되었습니다.');
  } catch (e) {
    print('파일 생성 실패: $e');
  }
}

void main() {
  String filePath = 'score.csv';
  Map<String, int> studentData = loadStudentData(filePath);

  print('사용하실 기능을 선택 하시오. ');
  print('(1: 우수 학생 점수 확인, 2: 학생 전체 평균 점수 확인, 3: 특정 학생 점수 조회');
  String? category = stdin.readLineSync();

  switch (category) {
    case '1':
      print('우수학생 점수를 조회합니다.');
      topStudent(studentData);

    case '2': // 학생 전체 평균 점수 확인
    case '3':
      while (true) {
        print('어떤 학생의 점수를 확인하시겠습니까? (그만하려면 exit or 종료 입력): ');
        String? inputName = stdin.readLineSync();

        if (inputName == null || inputName.isEmpty) continue;
        if (studentData.containsKey(inputName)) {
          print('$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.');
          writeFile(
            '$inputName.csv',
            '$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.',
          );
          print('생성된 파일 이름은 : $inputName');
        } else {
          print('$inputName 학생은 없는 학생입니다.');
        }
      }
  }
}

```



**topStudent() 메서드 생성** 
- 학생들 이름과 점수가 담긴 Map 타입 변수 `studentData` 를 매개변수로 받는다.

`int topScore = studentData.values.reduce((a, b) => a > b ? a : b);`
→가져온 `studentData` 데이터 중 `values` 값을 하나씩 순서대로 꺼내서 함수 (a,b)에 넣고 큰 수를 비교하여 가장 큰 값만 반환함

```dart
  var topStudent = studentData.keys.where(
    (name) => studentData[name] == topScore,
  );
```

- Iterable 메서드 `.where` 사용
- `name`은 keys 중 하나
- `studentData[name]` → 학생 점수(Value)
- `== topScore` → 최고 점수와 비교
- 즉, 최고 점수를 Value로 가진 Key(학생이름)을 반환

##### refactor - math 라이브러리 사용
```dart
  // 두 값을 비교해서 더 큰 값 하나만 반환한다.
  // reduce : 모든 값을 하나씩 순서대로 꺼내서 함수 (a,b)에 넣고 누적해서 하나의 결과를 만든다
  int topScore = studentData.values.reduce((a, b) => a > b ? a : b);

  //math 라이브러리의 max 함수 사용으로 더 간편하게 가장 큰 값 구하기
  int topScore = studentData.values.reduce(math.max);
```

- `math.max` → math 라이브러리의 max 함수 사용으로 쉽게 가장 큰 값 구하기

---

#### 3-2 학생 전체 평균 점수 구하기

```dart
import 'dart:io';
import 'dart:math' as math;

class Student {
  String name;
  int score;

  Student(this.name, this.score);

  void showInfo() {
    print('이름: $name,점수: $score');
  }
}

// csv파일에서 학생 데이터 가져오기
Map<String, int> loadStudentData(String filePath) {
  Map<String, int> studentMap = {};
  try {
    final file = File(filePath);
    final line = file.readAsLinesSync(); // -> csv파일의 각 줄을 리스트로 가져옴

    for (var line in line) {
      final isLineEmpty = line.trim();

      if (isLineEmpty.isEmpty) {
        continue; // 빈 줄이면 다음 줄로 넘어감
      }
      final parts = line.split(',');
      if (parts.length != 2) {
        throw FormatException('잘못된 데이터 형식: $line');
      }
      String name = parts[0];
      int score = int.parse(parts[1]);

      studentMap.putIfAbsent(name, () => score);
    }
  } catch (e) {
    print("학생 데이터 가져오기 실패 $e");
    exit(1);
  }

  print('csv파일에서 가져온 학생 점수 데이터 : $studentMap');

  return studentMap;
}

void topStudent(Map<String, int> studentData) {
  if (studentData.isEmpty) {
    print('데이터가 없습니다.');
    return;
  }
  // 두 값을 비교해서 더 큰 값 하나만 반환한다.
  // reduce : 모든 값을 하나씩 순서대로 꺼내서 함수 (a,b)에 넣고 누적해서 하나의 결과를 만든다
  // int topScore = studentData.values.reduce((a, b) => a > b ? a : b);

  //math 라이브러리의 max 함수 사용으로 더 간편하게 가장 큰 값 구하기
  int topScore = studentData.values.reduce(math.max);

  var topStudent = studentData.keys.where(
    (name) => studentData[name] == topScore,
  );

  print('우수생 : $topStudent (점수 : $topScore 점)');
}

void avg(Map<String, int> studentData) {
  if (studentData.isEmpty) {
    print('데이터가 없습니다.');
    return;
  }
  int sum = studentData.values.reduce((a, b) => a + b);

  double avgScore = sum / studentData.length;
  print(avgScore);
}

void writeFile(String filename, String content) {
  try {
    final file = File(filename);
    file.writeAsStringSync(content);
    print('$filename 파일이 생성되었습니다.');
  } catch (e) {
    print('파일 생성 실패: $e');
  }
}

void main() {
  String filePath = 'score.csv';
  Map<String, int> studentData = loadStudentData(filePath);

  print('사용하실 기능을 선택 하시오. ');
  print('(1: 우수 학생 점수 확인, 2: 학생 전체 평균 점수 확인, 3: 특정 학생 점수 조회)');
  String? category = stdin.readLineSync();

  switch (category) {
    case '1':
      print('우수학생 점수를 조회합니다.');
      topStudent(studentData);

    case '2': // 학생 전체 평균 점수 확인
      print('학생 전체의 평균을 구합니다.');
      avg(studentData);

      break;
    case '3':
      while (true) {
        print('어떤 학생의 점수를 확인하시겠습니까? (그만하려면 exit or 종료 입력): ');
        String? inputName = stdin.readLineSync();

        if (inputName == null || inputName.isEmpty) continue;

        // 종료기능
        if (inputName == 'exit' || inputName == '종료') {
          print('종료합니다.');
          break;
        }
        ;

        if (studentData.containsKey(inputName)) {
          print('$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.');
          writeFile(
            '$inputName.csv',
            '$inputName 학생의 점수는 ${studentData[inputName]}점 입니다.',
          );
          print('생성된 파일 이름은 : $inputName');
        } else {
          print('$inputName 학생은 없는 학생입니다.');
        }
      }
  }
}

```

```dart
void avg(Map<String, int> studentData) {
  if (studentData.isEmpty) {
    print('데이터가 없습니다.');
    return;
  }
  int sum = studentData.values.reduce((a, b) => a + b);

  double avgScore = sum / studentData.length;
  print(avgScore);
}
```

- `dart:math` 라이브러리에 따로 평균을 구하는 함수가 없어서 `reduce()`함수 사용
- 매개변수로 가져온  `studentData` 데이터 중 `values` 값을 하나씩 순서대로 꺼내서 함수 (a,b)에 넣고 각각 모두 더해 `sum` 변수에 반환
- `sum`을 `studentData.length`로 나눠서 평균값 구하기

